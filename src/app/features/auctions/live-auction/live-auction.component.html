<div class="live-auction-container min-vh-100 bg-light">
  <!-- Thank You Animation (All Users) -->
  @if (showThankYouAnimation) {
    <div class="thank-you-overlay">
      <div class="thank-you-content">
        <div class="thank-you-icon">
          <i class="bi bi-check-circle-fill"></i>
        </div>
        <h1 class="thank-you-title">Thank You!</h1>
        <h2 class="thank-you-subtitle">Auction Completed Successfully</h2>
        @if (auctionEndedData?.finalStats) {
          <div class="thank-you-stats">
            <div class="stat-item">
              <span class="stat-label">Total Players Sold:</span>
              <span class="stat-value">{{ auctionEndedData.finalStats.playersSold }}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Total Amount:</span>
              <span class="stat-value">₹{{ auctionEndedData.finalStats.totalAmountSpent | number }}</span>
            </div>
          </div>
        }
        <button class="btn btn-primary btn-lg mt-4" (click)="goBack()">
          <i class="bi bi-arrow-left me-2"></i>Back to Events
        </button>
      </div>
    </div>
  }
  
  <!-- Player Result Animation -->
  <app-player-result-animation 
    [soldData]="soldAnimationData"
    [unsoldData]="unsoldAnimationData">
  </app-player-result-animation>
  <!-- Header -->
  <div class="bg-white border-bottom shadow-sm sticky-top" style="z-index: 100;">
    <div class="container-fluid px-3 px-md-4 py-2 py-md-3">
      <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-2">
        <div class="d-flex align-items-center gap-2 gap-md-3 w-100 w-md-auto">
          <button class="btn btn-outline-secondary btn-sm" (click)="goBack()">
            <i class="bi bi-arrow-left d-md-inline me-md-2"></i>
            <span class="d-none d-md-inline">Back</span>
          </button>
          <div class="flex-grow-1">
            <h2 class="h5 h4-md mb-0 fw-bold text-truncate">{{ event?.name || 'Loading...' }}</h2>
            @if (event) {
              <small class="text-muted d-none d-md-block">{{ event.description || 'Live Auction' }}</small>
            }
          </div>
        </div>
        @if (event) {
          <span class="badge bg-danger align-self-md-start" [class.bg-success]="isAuctionStarted">
            @if (isAuctionStarted) {
              <i class="bi bi-circle-fill me-1" style="font-size: 0.5rem;"></i>LIVE
            } @else {
              <i class="bi bi-clock me-1"></i><span class="d-none d-md-inline">{{ event.status | titlecase }}</span>
            }
          </span>
        }
      </div>
    </div>
  </div>

  <!-- Content -->
  <div class="container-fluid px-4 py-5">
    @if (isLoading) {
      <div class="text-center py-5">
        <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="text-muted">Loading auction details...</p>
      </div>
    } @else if (!event) {
      <div class="text-center py-5">
        <i class="bi bi-exclamation-circle display-1 text-muted mb-3"></i>
        <h3 class="h4 mb-2">Event Not Found</h3>
        <p class="text-muted mb-4">The auction event you're looking for doesn't exist.</p>
        <button class="btn btn-primary" (click)="goBack()">Go Back to Events</button>
      </div>
    } @else if (!isAuctionStarted) {
      <!-- Countdown Timer - Auction Not Started -->
      <div class="row justify-content-center">
        <div class="col-12 col-md-8 col-lg-6">
          <div class="card shadow-lg border-0 text-center">
            <div class="card-body p-5">
              <div class="mb-4">
                <i class="bi bi-clock-history display-1 text-primary"></i>
              </div>
              <h3 class="h2 fw-bold mb-3">Auction Starting Soon</h3>
              <p class="text-muted mb-4">The auction will begin automatically when the countdown reaches zero.</p>
              
              <!-- Countdown Timer -->
              <div class="countdown-timer mb-4">
                @if (timeRemainingParts.length > 0) {
                  <div class="d-flex justify-content-center gap-3 flex-wrap">
                    @for (part of timeRemainingParts; track part.label) {
                      <div class="countdown-item text-center">
                        <div class="countdown-value bg-primary text-white rounded p-3 shadow-sm mb-2">
                          <span class="display-6 fw-bold">{{ part.value }}</span>
                        </div>
                        <small class="text-muted text-uppercase fw-semibold">{{ part.label }}</small>
                      </div>
                    }
                  </div>
                } @else {
                  <div class="text-center">
                    <div class="spinner-border text-primary mb-3" role="status">
                      <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="text-muted">{{ timeRemaining || 'Calculating countdown...' }}</p>
                  </div>
                }
              </div>

              <div class="alert alert-info mb-0">
                <i class="bi bi-info-circle me-2"></i>
                <strong>Start Date:</strong> {{ event.startDate | date: 'full' }}
              </div>
            </div>
          </div>
        </div>
      </div>
    } @else {
      <!-- Live Auction Interface - Auction Started -->
      <div class="row">
        <div class="col-12">
          <div class="alert alert-success alert-dismissible fade show" role="alert">
            <strong><i class="bi bi-check-circle me-2"></i>Auction is Live!</strong> Bidding is now open.
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        </div>
      </div>

      <!-- Admin: Start Player Auction -->
      @if (isAdmin() && !currentPlayer) {
        <div class="row mb-3 mb-md-4">
          <div class="col-12">
            <div class="card shadow-sm border-0">
              <div class="card-header bg-warning text-dark">
                <div class="d-flex justify-content-between align-items-center">
                  <h5 class="card-title mb-0">
                    <i class="bi bi-play-circle me-2"></i>Start Player Auction
                  </h5>
                  <div class="form-check form-switch">
                    <input 
                      class="form-check-input" 
                      type="checkbox" 
                      id="autoStartToggle"
                      [(ngModel)]="autoStartEnabled"
                      (change)="toggleAutoStart()"
                      style="cursor: pointer;"
                    />
                    <label class="form-check-label text-dark fw-semibold" for="autoStartToggle" style="cursor: pointer;">
                      <i class="bi bi-lightning-charge me-1"></i>Auto Start
                    </label>
                  </div>
                </div>
              </div>
              <div class="card-body p-3 p-md-4">
                @if (autoStartEnabled) {
                  <div class="alert alert-success mb-3">
                    <i class="bi bi-check-circle me-2"></i>
                    <strong>Auto-start enabled:</strong> Next player will start automatically after current player is sold.
                  </div>
                }
                <label class="form-label fw-semibold mb-3">Select Player to Start Auction</label>
                <div class="row g-3">
                  <div class="col-12 col-md-8">
                    <select 
                      class="form-select form-select-lg" 
                      [(ngModel)]="selectedPlayerId" 
                      [disabled]="isRandomMode"
                      style="min-height: 48px; font-size: 1rem;"
                    >
                      <option value="">-- Select a player --</option>
                      @for (player of getSelectablePlayers(); track player._id) {
                        <option [value]="player._id">{{ player.name }} - {{ player.role }} (₹{{ player.basePrice | number }})</option>
                      }
                    </select>
                    @if (isRandomMode) {
                      <small class="text-info d-block mt-2">
                        <i class="bi bi-info-circle me-1"></i>Random player will be selected
                      </small>
                    }
                  </div>
                  <div class="col-12 col-md-4">
                    <div class="d-flex flex-column flex-md-row gap-2">
                      <button 
                        class="btn btn-warning btn-lg flex-fill" 
                        [disabled]="(!selectedPlayerId && !isRandomMode) || isLoading || availablePlayers.length === 0"
                        (click)="startPlayerAuction()"
                        style="min-height: 48px; font-size: 1rem; font-weight: 600;"
                      >
                        @if (isLoading) {
                          <span class="spinner-border spinner-border-sm me-2"></span>
                        } @else {
                          <i class="bi bi-play-fill me-2"></i>
                        }
                        Start Auction
                      </button>
                      <button 
                        class="btn btn-outline-primary btn-lg" 
                        [disabled]="isLoading || availablePlayers.length === 0"
                        (click)="startRandomPlayer()"
                        title="Start auction for random player"
                        style="min-height: 48px; min-width: 48px; padding: 0.5rem;"
                      >
                        <i class="bi bi-shuffle fs-5"></i>
                        <span class="d-md-none ms-2">Random</span>
                      </button>
                    </div>
                    <small class="text-muted d-block mt-2 text-center text-md-start">
                      <i class="bi bi-info-circle me-1"></i>
                      Click <i class="bi bi-shuffle"></i> for random player
                    </small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      }

      <!-- Current Player Section -->
      @if (currentPlayer) {
        <div class="row g-4">
          <!-- Current Player Card -->
          <div class="col-12 col-lg-8">
            <div class="card shadow-sm border-0">
              <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">
                  <i class="bi bi-person-badge me-2"></i>Current Player on Auction
                </h5>
                @if (playerStartTime) {
                  <div class="player-timer d-flex align-items-center">
                    <div class="timer-display bg-warning text-dark rounded px-4 py-2 shadow-lg" 
                         [class.bg-danger]="playerAuctionTimer <= 10"
                         [class.text-white]="playerAuctionTimer <= 10">
                      <div class="d-flex align-items-center gap-2">
                        <i class="bi bi-clock-history fs-4"></i>
                        <div>
                          <div class="fw-bold fs-5 mb-0">{{ playerAuctionTimer }}</div>
                          <small class="d-block text-center" style="font-size: 0.7rem;">seconds</small>
                        </div>
                      </div>
                    </div>
                  </div>
                }
              </div>
              <div class="card-body p-4">
                <div class="row g-4">
                  <!-- Player Photo -->
                  <div class="col-12 col-md-4 text-center">
                    @if (currentPlayer.photo) {
                      <img 
                        [src]="imageService.getPhotoUrl(currentPlayer.photo)" 
                        [alt]="currentPlayer.name"
                        class="img-fluid rounded shadow-sm mb-3"
                        style="max-height: 300px; object-fit: cover;"
                      />
                    } @else {
                      <div class="bg-light rounded d-flex align-items-center justify-content-center mb-3" style="height: 300px;">
                        <i class="bi bi-person-circle display-1 text-muted"></i>
                      </div>
                    }
                  </div>
                  
                  <!-- Player Details -->
                  <div class="col-12 col-md-8">
                    <h3 class="h4 fw-bold mb-3">{{ currentPlayer.name }}</h3>
                    <div class="row g-3 mb-4">
                      <div class="col-6">
                        <small class="text-muted d-block">Role</small>
                        <strong class="text-capitalize">{{ currentPlayer.role }}</strong>
                      </div>
                      <div class="col-6">
                        <small class="text-muted d-block">Age</small>
                        <strong>{{ currentPlayer.age }} years</strong>
                      </div>
                      <div class="col-6">
                        <small class="text-muted d-block">Base Price</small>
                        <strong class="text-success">₹{{ currentPlayer.basePrice | number }}</strong>
                      </div>
                    </div>

                    <!-- Timer Display (Prominent) -->
                    @if (playerStartTime) {
                      <div class="alert alert-warning mb-3 mb-md-4 border-3" 
                           [class.alert-danger]="playerAuctionTimer <= 10"
                           [class.border-danger]="playerAuctionTimer <= 10">
                        <div class="d-flex flex-column flex-md-row justify-content-between align-items-center gap-2">
                          <div class="text-center text-md-start">
                            <small class="text-muted d-block mb-1">Time Remaining for Bidding</small>
                            <h2 class="h3 h2-md mb-0 fw-bold" [class.text-danger]="playerAuctionTimer <= 10">
                              <i class="bi bi-clock-history me-2"></i>
                              {{ playerAuctionTimer }} seconds
                            </h2>
                          </div>
                          @if (playerAuctionTimer <= 10) {
                            <div class="text-center text-md-end">
                              <i class="bi bi-exclamation-triangle-fill fs-2 fs-md-1 text-danger"></i>
                              <div class="small fw-bold">Hurry Up!</div>
                            </div>
                          }
                        </div>
                      </div>
                    }
                    
                    <!-- Current Bid Display -->
                    <div class="alert alert-info mb-3 mb-md-4">
                      <div class="d-flex flex-column flex-md-row justify-content-between align-items-center gap-2">
                        <div class="text-center text-md-start">
                          <small class="text-muted d-block">Current Bid</small>
                          <h4 class="h5 h4-md mb-0 fw-bold">₹{{ currentBidAmount | number }}</h4>
                          @if (winningTeam) {
                            <small class="text-muted d-block d-md-inline">Winning Team: {{ winningTeam.name || winningTeam.shortName }}</small>
                          }
                        </div>
                        @if (nextBidAmount) {
                          <div class="text-center text-md-end">
                            <small class="text-muted d-block">Next Bid</small>
                            <h5 class="h6 h5-md mb-0 text-primary">₹{{ nextBidAmount | number }}</h5>
                          </div>
                        }
                      </div>
                    </div>

                    <!-- Bidding Interface (Team Owners Only) -->
                    @if (isTeamOwner()) {
                      <div class="border-top pt-3 pt-md-4 bidding-section">
                        <h5 class="fw-semibold mb-3">Place Your Bid</h5>
                        <div class="row g-3">
                          <div class="col-12">
                            <label class="form-label mb-2 fw-semibold">Bid Amount (₹)</label>
                            <div class="bid-input-wrapper">
                              <div class="input-group input-group-lg">
                                <span class="input-group-text bg-light border-end-0">₹</span>
                                <input 
                                  type="text" 
                                  class="form-control bid-input border-start-0"
                                  [value]="bidAmount | number"
                                  readonly
                                  disabled
                                />
                              </div>
                              @if (nextBidAmount) {
                                <small class="form-text text-muted mt-2 d-block text-center text-md-start">
                                  <i class="bi bi-info-circle me-1"></i>
                                  Next bid amount: ₹<strong>{{ nextBidAmount | number }}</strong> (Auto-set)
                                </small>
                              }
                            </div>
                          </div>
                          <div class="col-12">
                            <button 
                              class="btn btn-success btn-lg w-100 bid-button"
                              [disabled]="isPlacingBid || isCurrentWinningBidder || bidAmount < (nextBidAmount || currentPlayer.basePrice) || bidAmount > getTeamBalance()"
                              (click)="placeBid()"
                            >
                              @if (isPlacingBid) {
                                <span class="spinner-border spinner-border-sm me-2"></span>
                                Placing...
                              } @else if (isCurrentWinningBidder) {
                                <i class="bi bi-trophy-fill me-2"></i>
                                You're Winning!
                              } @else {
                                <i class="bi bi-hand-thumbs-up me-2"></i>
                                Place Bid
                              }
                            </button>
                          </div>
                        </div>
                        @if (isCurrentWinningBidder) {
                          <div class="alert alert-success mt-3 mb-0 d-flex align-items-center">
                            <i class="bi bi-trophy-fill me-2 fs-5"></i>
                            <div>
                              <strong>You are currently the winning bidder!</strong> Wait for someone else to bid above you.
                            </div>
                          </div>
                        } @else if (bidAmount > getTeamBalance()) {
                          <div class="alert alert-warning mt-3 mb-0 d-flex align-items-center">
                            <i class="bi bi-exclamation-triangle me-2 fs-5"></i>
                            <div>
                              Insufficient balance. Your balance: ₹<strong>{{ getTeamBalance() | number }}</strong>
                            </div>
                          </div>
                        }
                      </div>
                    } @else if (isAdmin()) {
                      <div class="alert alert-info mb-0">
                        <i class="bi bi-info-circle me-2"></i>
                        Only team owners can place bids. You can start the next player auction.
                      </div>
                    }
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Sidebar -->
          <div class="col-12 col-lg-4">
            <!-- Team Balance (Team Owners Only) -->
            @if (isTeamOwner()) {
              <div class="card shadow-sm border-0 mb-4">
                <div class="card-header bg-info text-white">
                  <h5 class="card-title mb-0">
                    <i class="bi bi-wallet2 me-2"></i>Your Balance
                  </h5>
                </div>
                <div class="card-body">
                  <div class="text-center">
                    <h3 class="display-6 display-4-md fw-bold text-primary">₹{{ getTeamBalance() | number }}</h3>
                    <p class="text-muted small mb-0">Available for bidding</p>
                  </div>
                </div>
              </div>
            }

            <!-- Auction Info -->
            <div class="card shadow-sm border-0">
              <div class="card-header bg-secondary text-white">
                <h5 class="card-title mb-0">
                  <i class="bi bi-info-circle me-2"></i>Auction Info
                </h5>
              </div>
              <div class="card-body">
                <dl class="row mb-0">
                  <dt class="col-sm-6">Status:</dt>
                  <dd class="col-sm-6">
                    <span class="badge bg-success">Live</span>
                  </dd>
                  <dt class="col-sm-6">Players:</dt>
                  <dd class="col-sm-6">{{ (event.players && event.players.length) || 0 }}</dd>
                  @if (event.stats) {
                    <dt class="col-sm-6">Sold:</dt>
                    <dd class="col-sm-6">{{ event.stats.playersSold || 0 }}</dd>
                    <dt class="col-sm-6">Unsold:</dt>
                    <dd class="col-sm-6">{{ event.stats.playersUnsold || 0 }}</dd>
                  }
                  @if (event.settings) {
                    <dt class="col-sm-6">Bid Increment:</dt>
                    <dd class="col-sm-6">₹{{ event.settings.bidIncrement | number }}</dd>
                  }
                </dl>
              </div>
            </div>
          </div>
        </div>
      } @else if (isAuctionStarted && !currentPlayer) {
        <!-- No Current Player -->
        <div class="row">
          <div class="col-12">
            <div class="card shadow-sm border-0 text-center">
              <div class="card-body p-5">
                <i class="bi bi-pause-circle display-1 text-muted mb-3"></i>
                <h4 class="mb-3">No Player Currently on Auction</h4>
                @if (isAdmin()) {
                  <p class="text-muted mb-4">Select a player above to start the auction.</p>
                } @else {
                  <p class="text-muted mb-0">Waiting for admin to start player auction...</p>
                }
              </div>
            </div>
          </div>
        </div>
      }
    }
  </div>
</div>
