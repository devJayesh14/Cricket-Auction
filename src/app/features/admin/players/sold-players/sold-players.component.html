<div class="sold-players-container min-vh-100 bg-light">
  <app-header></app-header>

  <div class="container-fluid px-4 py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h1 class="h2 fw-bold mb-2">Sold Players</h1>
        @if (eventName) {
          <p class="text-muted mb-0">Event: <strong>{{ eventName }}</strong></p>
        } @else {
          <p class="text-muted mb-0">View all sold players grouped by team</p>
        }
      </div>
      <button class="btn btn-outline-secondary" (click)="router.navigate(['/admin/players/list'])">
        <i class="bi bi-arrow-left me-2"></i>Back to Players
      </button>
    </div>

    @if (isLoading) {
      <div class="text-center py-5">
        <div class="spinner-border text-primary" role="status"></div>
        <p class="text-muted mt-3">Loading sold players...</p>
      </div>
    } @else if (teamGroups.length === 0) {
      <div class="text-center py-5 bg-white rounded shadow-sm">
        <i class="bi bi-inbox display-1 text-muted mb-3"></i>
        <h3 class="h4 mb-2">No Sold Players</h3>
        <p class="text-muted mb-4">No players have been sold yet</p>
      </div>
    } @else {
      <div class="row g-4">
        @for (team of teamGroups; track team.teamId) {
          <div class="col-12 col-lg-6 col-xl-4">
            <div class="card h-100 shadow-sm border-0">
              <!-- Team Header -->
              <div class="card-header bg-primary text-white p-3">
                <div class="d-flex align-items-center gap-3">
                  @if (team.teamLogo) {
                    <img 
                      [src]="baseUrl + '/' + team.teamLogo" 
                      [alt]="team.teamName"
                      class="rounded"
                      style="width: 50px; height: 50px; object-fit: cover;"
                    />
                  } @else {
                    <div class="bg-white bg-opacity-20 rounded d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                      <i class="bi bi-people fs-4"></i>
                    </div>
                  }
                  <div class="flex-grow-1">
                    <h5 class="card-title mb-0 fw-bold">{{ team.teamName }}</h5>
                    @if (team.teamShortName) {
                      <small class="opacity-75">{{ team.teamShortName }}</small>
                    }
                  </div>
                </div>
              </div>

              <!-- Team Stats -->
              <div class="card-body p-3 border-bottom bg-light">
                <div class="row text-center">
                  <div class="col-6">
                    <div class="d-flex flex-column">
                      <span class="text-muted small">Players</span>
                      <span class="fw-bold fs-5">{{ team.players.length }}</span>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="d-flex flex-column">
                      <span class="text-muted small">Total Spent</span>
                      <span class="fw-bold fs-5 text-success">{{ formatCurrency(team.totalSpent) }}</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Players List -->
              <div class="card-body p-0" style="max-height: 400px; overflow-y: auto;">
                <div class="list-group list-group-flush">
                  @for (player of team.players; track player._id) {
                    <div class="list-group-item">
                      <div class="d-flex align-items-center gap-3">
                        <!-- Player Photo -->
                        @if (player.photo) {
                          <img 
                            [src]="baseUrl + '/' + player.photo" 
                            [alt]="player.name"
                            class="rounded"
                            style="width: 60px; height: 60px; object-fit: cover;"
                          />
                        } @else {
                          <div class="bg-secondary rounded d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                            <i class="bi bi-person text-white fs-4"></i>
                          </div>
                        }

                        <!-- Player Info -->
                        <div class="flex-grow-1">
                          <h6 class="mb-1 fw-bold">{{ player.name }}</h6>
                          <div class="d-flex align-items-center gap-2 mb-1">
                            <span class="badge bg-{{ getRoleBadgeClass(player.role) }}">
                              {{ player.role | titlecase }}
                            </span>
                            <span class="badge bg-info">{{ player.age }} yrs</span>
                          </div>
                          <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted">Base: {{ formatCurrency(player.basePrice) }}</small>
                            <strong class="text-success">Sold: {{ formatCurrency(player.soldPrice || player.basePrice) }}</strong>
                          </div>
                        </div>
                      </div>
                    </div>
                  }
                </div>
              </div>
            </div>
          </div>
        }
      </div>
    }
  </div>
</div>

